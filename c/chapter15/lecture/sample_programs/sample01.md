# 15章: ポインタ変数の仕組み

## メモリの仕組み

### メモリ?

メモリという単語は、コンピュータに興味のある人には馴染み深い言葉です。
このメモリに、コンピュータのデータが記憶されていることは、コンピュータをよく知らない人でも聞いたことのある話だと思います。

一般人のコンピュータ知識としては、それで十分なのですが、プログラミングをする場合には、それだけでは不十分なのです。
メモリがデータを記憶するのはどのような仕組みなのかをしっかりと理解しておく必要があるでしょう。
  
ここではCMOSの構造といったようなハード的な仕組みではなくどのような仕組みでデータを蓄えるのかといったようなソフト的な説明を行っていきます。そして、プログラムでは、どんな方法でメモリを取り扱うのかを説明します。

### 超巨大な1列ロッカー

メモリの中には、非常に多くの電子部品が組み込まれていて、その1つ1つが、自分自身の状態を持っています。状態、すなわち、オンかオフであるということです。

そして、電子部品の状態がオンならば1、オフならば0というようにそれぞれの部品が1であるか0であるかを記憶しています。

これは、例えるならば、超巨大な1列ロッカーのような構造です。その数は、10や100といった、常識的な数では済まされません。メモリが64MBのコンピュータならば、5億個以上のロッカーが並んでいます。

そして、そのロッカーには、番号がつけられています。また、1つ1つのロッカーは、荷物という状態を持っています。
荷物が入っていたら1、入っていなかったら0としてカウントしましょう。

コンピュータは、このロッカーに荷物を詰め込んで、数値を記憶します。すべての数値は、1と0の組み合わせで記憶されています。要するに、コンピュータは数値を2進数で記憶しているのです。

### CPUのビット数

ビットという言葉も、おそらく聞いたことがあるのではないでしょうか。今、我々が使っているコンピュータは64ビットです。

ところで、このビットとは、一体何のことなのでしょうか。実は、今回のテーマである、メモリととても深く関係しているのです。

先ほど、メモリとは超巨大な1列ロッカーであると説明しました。そして、数値は2進数として記録されているとも説明しました。しかし、このデータはすべて2進数で記録されていますから、いちいち1つ1つのデータをやりとりしていてはとても面倒です。

そこで、誰でも思いつくのは、何個かまとめて使う方法です。たとえば、メモリデータの内、8個をまとめて使うようにすれば、2進数で00000000~11111111の範囲の数、すなわち10進数で0~255の範囲の数を使って計算できるって寸法です。
これなら、結構マトモな計算が出来そうです。

すでに気づいた人がいるかもしれませんが、その通りです。
CPUが1回で扱うメモリの2進数での桁数が、ビット数なのです。
CPUが何ビットと言ったような場合には、だいたいそのような意味です。
ただし、特殊命令でそれ以上のビット数を一度に計算できるCPUもあります。

なお、1ビットとは、2進数1桁のことを意味しています。
先ほどの場合、CPUの処理単位が32ビットであるということです。

### 32ビットのロッカー

CPUは、メモリのデータの何個かをひとまとめにして取り扱うことを説明しました。
32ビットCPUの場合は、32個のメモリのデータをひとまとめにして取り扱っています。
これを、32ビットコンピュータと呼ぶわけです。
ここから先では、この32ビットを前提として話を進めていくことにします。
(現在では64ビットコンピュータが主流ですが、ここでは32ビットをメインに扱っていきます。)

32ビットのコンピュータは、32個のデータをひとまとめにして扱います。
つまり、超巨大な1列ロッカーは、32個ずつ仕分けして使えば良いのです。
しかし、現実には8個ずつに仕分けされて、それぞれに番号がつけられています。
8個ずつにデータを区分けするということは、メモリを8ビット単位で取り扱うということです。

8ビットは1バイトとも呼ばれていて、コンピュータの基本的な単位となっています。
これは、色々なデータを扱う上で、8ビットは都合が良いからです。
8ビットで0~255の数値を表すことができるので、比較的小さな数値の記憶には最適です。
また、2進数で動作するコンピュータにとって、8ビットはキリの良い桁でもあります。

このような事情から、実際のコンピュータでのメモリの取り扱いは、ロッカーを8個ずつにまとめて、8個を1単位として番号を割り当てています。
32ビットコンピュータでは、これに32ビットの範囲内で番号が割り当てられています。
32ビットの範囲内ということは、すなわち、2進数で00000000000000000000000000000000~11111111111111111111111111111111の範囲内であり、10進数で約42億番までの8ビットの数値を扱うことができるのです。

## 変数とメモリの関係

### 変数はメモリ上に存在する

第5章での変数の説明時に、変数はメモリに作られると説明しました。
しかし、その具体的な内容についてはまったく説明してきませんでした。
それは、変数を扱うだけなら、そこまで知る必要がなかったからです。

しかし、この先で取り扱うポインタという概念を理解するためには、
変数がどのようにメモリに格納されているかを知っておく必要があります。

前節で説明した通り、コンピュータのメモリとは、巨大な1列ロッカーのような構造です。
そして、このロッカーは、一つ一つがオンとオフの2つの状態を記憶しています。
このロッカー1つを1ビット、8つをまとめて1バイトと呼びます。

<center>ロッカー1つ: 1ビット</center>
<center>ロッカー8つ: 1バイト</center>

メモリには、この1バイト毎に番号がつけられて区別されているのです。

プログラムで宣言した変数も、このメモリに番号付きで記憶されています。
ただ、番号で区別するのではわかりにくいので、名前をつけているのです。
実行ファイルにコンパイルすると、変数名は番号に変換されます。

要するに、すべての変数はメモリに作られており、
そこでは、番号をつけて区別しているということをまずは頭に入れてください。

#### C言語はこんな言語である

以後、この章では、C言語の実態に迫る展開が多々見られます。
今までの章で説明されてなかったことの多くがこの章で明らかにされます。
その中では、C言語の文法などを批判するような展開も多く見られます。

そもそも、C言語は、デニス・リッチーという人物が、自分たちで使うためだけに作ったプログラミング言語であって、
世界中で使われるようになるとはまったく考えていなかったのです。
その為、作った人の都合に合わせたような部分が見られ、普通の人々には不親切な文法の言語になっています。

しかし、それでも、C言語は世界中で使われているのです。
ところどころ不可解な部分はありますが、最も汎用性のある言語であり、
小さな部品から、ゲームプログラムまで、幅広く使用されています。
