# 入力の恐怖 「苦Cより」

## 恐怖の入力ミス

もしかしたら,筆者は相当なひねくれ者なのかもしれません。  
前節では良いプログラムの見本のように紹介しておきながら、先程書いたプログラムに問題があると文句を付けるつもりでいるからです。

一体、先程のプログラムのどこに問題があったのでしょうか...?  
実は、scanf関数を使用していることが問題なのです。

scanf関数は、いろいろな問題を抱えている関数です。  
入門書では比較的よく使われるにも関わらず、本格的な開発では使われません。  
会社(学校)によっては、scanf関数禁止令を出していることもあります。  
一体、どこに問題があるのか...  
それは、入力ミスです。

正しく使っている限り、scanf関数はとくに問題を引き起こすことはありませんが、入力ミスがあった場合は途端に恐ろしい問題を引き起こすことがあります。  
これから、先程のプログラムを題材に入力ミスのケースを紹介します。

## Case 1: 区切り記号のミス

入力ミスの例として、区切り記号を打ち間違えてみます。先程のプログラムでは、「,」で区切るようにしていましたが、これをあえて無視してスペースで区切ってみたいと思います。

区切り記号を打ち間違えた場合の実行結果です。

``` 実行結果
最小値と最大値を , で区切って入力してください。
100 200
100 〜 34815592 の合計は -94580482 です。
```

はじめに入力した 100 の方は正常に入力されているようなのですが、後の 200 の方はなぜか 34815592 という数値になってしまっています。この結果は使用するコンパイラによって異なってくるので、皆さんが実行させてみた場合は、別の結果が出てくるのかもしれません。

## Case 2: 大きすぎる数値

次に、極端に大きな数値を入力させてみたいと思います。

``` 実行結果
最小値と最大値を , で区切って入力してください。
1, 2000000000000
1 〜 -1454759936 の合計は 379916288 です。
```

2000000000000 を入力したはずなのに、なぜか -1454759936 と認識されてしまっています。合計も 2000000000000 までの合計値であるはずなので小さくなることはないはずです。

これらは、記憶できる範囲の限界を超えてしまったために起こる問題です。入力のチェックをしようにも、入力された変数自体に -1454759936 と代入されているので、-1454759936 を入れたかったのか、打ち間違えて -1454759936 になったのかの区別ができません。

## 文字列の恐怖

さらに天邪鬼な実験をしてみたいと思います。
すなわち、数値を入力しろと言われているのに、文字を入力してみるのです。  
次は、文字列を入力した場合の実行結果です。

``` 実行結果
最小値と最大値を , で区切って入力してください。
ABCDEF
1 〜 42942056 の合計は 888857684 です。
```

もはやめちゃくちゃです。どうしてこうなったのかは、ビットの対応関係で説明できるのですがここでの説明は省略します。  
重要なのは、文字列を入力しているのにも関わらず、なぜか計算されてしまっているという点です。

代入された数値 1, 42942056 はどこから出てきたのでしょうか。  
当然、この数値自体が入力されたのか、入力ミスなのかは判別できません。

皆さんは、まさかこんな間抜けなミスを犯す人はいないと考えるかもしれませんが、寝ぼけているかも知れませんし、ペットの猫がキーボードを踏みつけるかもしれません。
さらに困ったことに、ウイルスやハッカーがわざとこのような入力をすることがあります。もし、大企業や政府で使われているプログラムでこんな事態が起こったら...

## 解決法について
散々色々な入力ミスを見せられて、もういい加減に疲れたかもしれません。そろそろ解決策を提示しないと、皆さんもうんざりしてしまうでしょう。

しかし、この問題の解決は簡単ではありません。

少なくとも、現在学んだ知識で解決することはできません。

解決策は、文字列として入力させて、そのデータを解析する方法が一般的です。つまり、この問題を解決するには文字列処理の方法を知らなくてはなりませんが、現在のあなたの知識では、文字列処理を行うことはできないのです。

この問題の解決手段は、ずっとあとになってから紹介することにします。それまでは仕方ないのでscanf関数を使い続けるしかありません。  
その間は、くれぐれも入力ミスには気をつけるようにしてください。
